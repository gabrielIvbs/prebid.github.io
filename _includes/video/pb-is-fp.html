<!DOCTYPE html>
<html lang="en" class="html--no-js">
  <head>
    {% include head--common.html %} {% include prebidjs-non-prod.html %}

    <!--pbjs and player code -->

    <link
      rel="stylesheet"
      href="//cdn.flowplayer.com/releases/native/3/stable/style/flowplayer.css"
    />
    <script
      type="text/plain"
      class="cmplazyload"
      data-cmp-purpose="c51"
      data-cmp-src="//cdn.flowplayer.com/releases/native/3/stable/flowplayer.min.js"
    ></script>
    <script
      type="text/plain"
      class="cmplazyload"
      data-cmp-purpose="c51"
      data-cmp-src="//cdn.flowplayer.com/releases/native/3/stable/plugins/ads.min.js"
    ></script>
    <script
      data-cmp-src="//imasdk.googleapis.com/js/sdkloader/ima3.js"
    ></script>

    <style>
      #player {
        max-width: 40em;
        width: 100%;
        float: left;
      }

      #controls {
        float: left;
        padding: 1em;
      }
    </style>

    <script>
      var pbjs = pbjs || {};
      pbjs.que = pbjs.que || [];

      const BIDDER1_PROVIDER = "appnexus";
      const BIDDER1_PLACEMENT_ID = "13232361";

      // The ad tag in Flowplayer can be actual ad tag or promise to an ad tag. &nbsp;
      // We return the ad tag if it is available before the player is ready to play &nbsp;
      // Otherwise the player waits for 2 secs for tag to be available.<br>
      var adtag = null;
      var timeout = 2000;
      window.prebid_fetcher = function () {
        if (adtag) return Promise.resolve(adtag);

        return new Promise(function (resolve) {
          setTimeout(function () {
            resolve(adtag);
          }, timeout);
        });
      };

      /*
   Prebid Video adUnit
   */

      var videoAdUnit = {
        code: "video1",
        sizes: [640, 480],
        mediaTypes: {
          video: {
            context: "instream",
            playerSize: [640, 480],
            mimes: ["video/mp4"],
            protocols: [1, 2, 3, 4, 5, 6, 7, 8],
            playbackmethod: [2],
            skip: 1,
          },
        },
        bids: [
          {
            bidder: BIDDER1_PROVIDER,
            params: {
              placementId: BIDDER1_PLACEMENT_ID,
            },
          },
        ],
      };

      pbjs.que.push(function () {
        pbjs.addAdUnits(videoAdUnit); // add your ad units to the bid request<br>

        pbjs.setConfig({
          debug: true,
          cache: {
            url: "https://prebid.adnxs.com/pbc/v1/cache",
          },
        });

        pbjs.requestBids({
          bidsBackHandler: function (bids) {
            var videoUrl = pbjs.adServers.dfp.buildVideoUrl({
              adUnit: videoAdUnit,
              params: {
                iu: "/19968336/prebid_cache_video_adunit",
                cust_params: {
                  section: "blog",
                  anotherKey: "anotherValue",
                },
                output: "vast",
              },
            });
            adtag = videoUrl;
          },
        });
      });
    </script>
  </head>

  <body></body>
</html>
